# MLX Whisper - Быстрая голосовая диктовка для macOS

Минималистичная утилита для транскрибации речи в текст на macOS с использованием MLX и Whisper. Работает локально, без отправки данных в облако.

## Возможности

- **Мгновенная диктовка** - запись и распознавание одной фразы с автоматической вставкой в буфер обмена
- **Непрерывный режим** - последовательная запись нескольких фрагментов
- **Toggle-режим** - включение/выключение записи по горячей клавише
- **Мультиязычность** - поддержка русского, английского и автоопределение языка
- **Локальная работа** - все вычисления на вашем устройстве через Apple Silicon

## Установка

### Требования
- macOS с Apple Silicon (M1/M2/M3)
- Python 3.9+
- Homebrew

### Быстрая установка

```bash
# Клонирование репозитория
git clone git@github.com:maxim-malikov/huyulie.git mlxwhisper
cd mlxwhisper

# Создание виртуального окружения
python3 -m venv .venv
source .venv/bin/activate

# Установка зависимостей
pip install mlx-whisper sounddevice numpy

# Установка SoX для аудио-сигналов (для звуковых сигналов)
brew install sox

# Установка Hammerspoon (для горячих клавиш)
brew install --cask hammerspoon

# Делаем скрипты исполняемыми
chmod +x mlxw mlxw-toggle
```

## Использование

### Базовые команды

```bash
# Одна фраза с автоопределением языка
./mlxw

# Одна фраза на русском
./mlxw ru

# Одна фраза на английском
./mlxw en

# Непрерывный режим
./mlxw continuous
```

### Toggle-режим (включение/выключение по клавише)

```bash
# Запуск toggle-режима на русском
./mlxw-toggle ru

# На английском
./mlxw-toggle en
```

В toggle-режиме:
- **Пробел** - начать/остановить запись
- **q** - выйти из программы

## Настройка горячих клавиш через Hammerspoon

### Автоматическая настройка

```bash
# Копируем готовый конфиг
cp hammerspoon/init.lua ~/.hammerspoon/init.lua

# Перезагружаем Hammerspoon
open -g hammerspoon://reload
```

### Горячие клавиши по умолчанию

- **⌘ Cmd + ⇧ Shift + D** — Быстрая диктовка (одна фраза)
- **⌃ Ctrl + ⌥ Alt + W** — Toggle-режим (вкл/выкл записи)
- **⌘ Cmd + ⇧ Shift + C** — Непрерывный режим
- **⌃ Ctrl + ⌥ Alt + R** — Перезагрузка конфига

### Изменение горячих клавиш

Откройте `~/.hammerspoon/init.lua` и найдите секцию `НАСТРОЙКИ ГОРЯЧИХ КЛАВИШ` в начале файла:

```lua
local HOTKEYS = {
    -- Быстрая диктовка
    quickDictation = {
        modifiers = {"cmd", "shift"},  -- Измените модификаторы
        key = "D",                     -- Измените клавишу
        lang = "ru"                    -- ru, en или nil для автодетекта
    },
    -- ... другие настройки
}
```

**Доступные модификаторы:**
- `"cmd"` — ⌘ Command
- `"shift"` — ⇧ Shift
- `"alt"` или `"option"` — ⌥ Option
- `"ctrl"` — ⌃ Control
- `"fn"` — Function

После изменений нажмите **⌃ Ctrl + ⌥ Alt + R** для перезагрузки или выполните:
```bash
open -g hammerspoon://reload
```

### Если установили в другую директорию

Измените путь в `~/.hammerspoon/init.lua`:

```lua
local MLXW_PATH = os.getenv("HOME") .. "/ваш_путь/mlxwhisper"
```

## Архитектура

- `rt.py` - основной модуль записи и транскрибации
- `rt_toggle.py` - модуль для toggle-режима
- `mlxw` - обертка для командной строки
- `mlxw-toggle` - обертка для toggle-режима

Подробная документация по архитектуре в [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md).

## Особенности

- Использует MLX для максимальной производительности на Apple Silicon
- Автоматическая нормализация аудио для лучшего распознавания
- Звуковые сигналы начала/конца записи (через SoX)
- Результат автоматически копируется в буфер обмена

## Лицензия

MIT